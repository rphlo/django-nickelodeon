{% load i18n %}{% load url from future %}{% load staticfiles %}<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="handheldFriendly" content="true">
    <link rel="icon" href="icons/favicon.ico">
    <title>Backbone JukeBox</title>
    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/3.2.0/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/font-awesome/4.2.0/css/font-awesome.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/enscroll/0.6.1/enscroll.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'nickelodeon/app.css' %}" rel="stylesheet">
  </head>
  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation" id="main_navbar">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">rphl.net JukeBox</a>
        </div>
      </div>
    </div>
    <!-- Begin page content -->
    <div id="main_div">
      <div class="container" id="jukebox_div">
        <div class="row" id="main_container" style="padding-top:15px">
          <div class="col-md-4 col-sm-12">
            <p>
              <kbd class="span-12" style="overflow: hidden; display: block; white-space:nowrap;">
                <span id="current_song_display" style="white-space:nowrap; display: block; overflow: hidden; text-overflow:ellipsis">Unknow</span>
              </kbd>
            </p>
            <div>
              <div class="btn-group">
                <a href="#" role="button" class="btn btn-sm btn-default" id="prev_button"><i class="fa fa-backward"></i></a>
                <a href="#" role="button" class="btn btn-sm btn-default" id="play_pause_button"><i class="fa fa-play"></i></a>
                <a href="#" role="button" class="btn btn-sm btn-default" id="next_button"><i class="fa fa-forward"></i></a>
              </div>
              <div class="btn-group">
                <a href="#" role="button" class="btn btn-sm btn-default active" id="use_aac_button">AAC</a>
                <a href="#" role="button" class="btn btn-sm btn-default" id="use_mp3_button">MP3</a>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-plus"></i>
                </button>
                <ul class="dropdown-menu" role="menu">
                  <!-- [
                  <li><a href="#" id="stop_next_button"><i class="fa fa-lg fa-stop"></i> Stop after current</a></li>
                  <li><a href="#" id="stop_end_queue_button"><i class="fa fa-lg fa-stop"></i> Stop at the end of the queue</a></li>
                  ]-->
                  <li><a href="#" id="edit_current_button"><i class="fa fa-lg fa-edit"></i> Edit</a></li>
                  <li><a href="#" id="download_current_button"><i class="fa fa-lg fa-download"></i> Download</a></li>
                  <li><a href="#" id="open_yt_modal_button"><i class="fa fa-lg fa-youtube"></i> Import from YouTube</a></li>
                </ul>
              </div>
            </div>
            <div style="padding-top:5px;">
              <div id="full_progress_bar" class="progress" style="cursor: pointer">
                <div id="progress_bar" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                  <span id="progress_bar_text" style="color:#666;padding:5px">00:00/00:00</span>
                </div>
              </div>
            </div>
            <div class="input-group" style="margin-top:-15px;margin-bottom:15px;">
              <input id="search_input" type="text" class="form-control" placeholder="Search"/>
              <span class="input-group-btn">
                <button id="search_button" class="btn btn-default" type="button">Search <i class="fa fa-search"></i></button>
              </span>
            </div>
          </div>
          <div class="col-md-8 col-sm-12">
            <ul class="nav nav-tabs small" role="tablist" id="tab_selector">
              <li class="active"><a href="#queueTab" role="tab" data-toggle="tab"><i class="fa fa-database"></i> Queue</a></li>
              <li><a href="#historyTab" role="tab" data-toggle="tab"><i class="fa fa-book"></i> History</a></li>
              <li><a id="search_tab" href="#searchTab" role="tab" data-toggle="tab" class="hidden"><i class="fa fa-search"></i> Search results</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane scrollable" id="searchTab">
                <div>
                  <table class="table table-striped">
                    <tbody id="search_results_table">
                      <tr><td>No search so far.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="tab-pane scrollable active" id="queueTab">
                <div>
                  <table class="table table-striped" id="play_queue_table">
                    <tr><td><i class="fa fa-random"></i> Random</td></tr>
                  </table>
                </div>
              </div>
              <div class="tab-pane scrollable" id="historyTab">
                <div>
                  <table class="table table-striped" id="play_history_table">
                    <tr><td>No history so far.</td></tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="yt_modal" tabindex="-1" role="dialog" aria-labelledby="yt_modal_label" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="yt_modal_label">Import from YouTube</h4>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="yt_url_input">YouTube URL</label>
                  <input type="text" class="form-control" id="yt_url_input" placeholder="YouTube URL">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="download_yt_button"><span id="download_yt_submitting_i"><i class="fa fa-circle-o-notch fa-spin"></i> </span>Download</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="edit_song_modal" tabindex="-1" role="dialog" aria-labelledby="edit_song_modal_label" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="edit_song_modal_label">Song details</h4>
              </div>
              <div class="modal-body">
                <form role="form">
                  <div class="form-group">
                    <label for="id_song_artist">Artist</label>
                    <input type="text" class="form-control" id="edit_song_artist_input" placeholder="Artist">
                  </div>
                  <div class="form-group">
                    <label for="id_song_title">Title</label>
                    <input type="text" class="form-control" id="edit_song_title_input" placeholder="Title">
                  </div>
                  <div class="form-group">
                    <label for="id_song_filename">File path</label>
                    <input type="text" class="form-control" id="edit_song_filename_input" placeholder="File path">
                  </div>
                  <label>
                    <input type="hidden" id='edit_song_uuid_input'>
                    <input type="hidden" id='edit_song_org_artist'>
                    <input type="hidden" id='edit_song_org_title'>
                    <input type="hidden" id='edit_song_org_filename'>
                  </label>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save_song_change_button"><span id="saving_song_change_i"><i class="fa fa-circle-o-notch fa-spin"></i> </span>Save changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer" id="main_footer">
        <div class="container">
          <p class="text-muted text-center">rphl.net &copy; 2014 Rapha&euml;l Stefanini</p>
        </div>
      </div>
    </div>

    <script type="text/template" id="search_loading_template">
      <tr><td><i class="fa fa-circle-o-notch fa-spin"></i> Searching &quot;<%= query %>&quot;</td></tr>
    </script>

    <script type="text/template" id="search_more_template">
      <tr><td><a href="#" class='search_more_button'><i class="fa fa-plus"></i> Search more</a></td></tr>
    </script>

    <script type="text/template" id="search_no_results_template">
      <tr><td><i class="fa fa-exclamation"></i> No result for &quot;<%= query %>&quot;</td></tr>
    </script>

    <script type="text/template" id="played_song_template">
      <td>
        <a href="/jukebox/<%= song.id %>"
           title="<%= song.get('filename') %>" class="song_link">
          <%= song.getDisplayText() %>
        </a>
      <td>
        <div class="dropdown">
          <a href="#"
             class="btn btn-default btn-xs"
             data-toggle="dropdown"
             role="button"
             title="Options"
             style="float:right; margin-left: 3px;">
            <i class="fa fa-cog fa-lg"></i>
          </a>
          <ul class="dropdown-menu text-left pull-right">
            <li class="edit_song_button">
              <a href="#"><i class="fa fa-edit"></i> Edit</a>
            </li>
            <li class="download_song_button">
              <a href="#"><i class="fa fa-download"></i> Download</a>
            </li>
          </ul>
        </div>
      </td>
    </script>

    <script type="text/template" id="history_queue_template">
      <tr><td><i class="fa fa-exclamation"></i> Nothing played</td></tr>
    </script>

<<<<<<< HEAD
    <script type="text/template" id="empty_queue_template">
      <tr><td><i class="fa fa-exclamation"></i> Nothing queued</td></tr>
    </script>
=======
      var extract_search_query_from_link = function(link){
        var query_re = /(\?|&)q=([^&]+)/;
        var matches = link.match(query_re)
        if(matches){
          return decodeURIComponent(matches[2].replace(/\+/g, '%20'));
        }
        return ''
      };
>>>>>>> 5fe5bfb9995622b926e3d2921e53b9ae1c7669a7

    <script type="text/template" id="queued_song_template">
      <td>
        <div class="btn-group">
          <a href="#" class="move_up_button btn btn-default btn-xs <% if(is_first){ %>disabled<% }%>" role="button">
            <i class="fa fa-chevron-up"></i>
          </a>
          <a href="#" class="move_down_button btn btn-default btn-xs <% if(is_last){ %>disabled<% }%>" role="button"s>
            <i class="fa fa-chevron-down"></i>
          </a>
        </div>
        <a href="/jukebox/<%= song.id %>"
           title="<%= song.get('filename') %>" class="song_link">
          <%= song.getDisplayText() %>
        </a>
      </td>
      <td>
        <div class="dropdown">
          <a href="#"
             class="btn btn-default btn-xs"
             data-toggle="dropdown"
             role="button"
             title="Options"
             style="float:right; margin-left: 3px;">
            <i class="fa fa-cog fa-lg"></i>
          </a>
          <ul class="dropdown-menu text-left pull-right">
            <li class="edit_song_button">
              <a href="#"><i class="fa fa-edit"></i> Edit</a>
            </li>
            <li class="download_song_button">
              <a href="#"><i class="fa fa-download"></i> Download</a>
            </li>
            <li class="drop_queued_song_button">
              <a href="#"><i class="fa fa-times"></i> Drop from queue</a>
            </li>
          </ul>
        </div>
      </td>
    </script>

    <script type="text/template" id="search_result_template">
      <td>
        <a href="/jukebox/<%= song.id %>"
           title="<%= song.get('filename') %>" class="song_link">
          <i class="fa fa-play"></i> <%= song.getDisplayText() %>
        </a>
      </td>
      <td>
        <div class="dropdown">
          <a href="#"
             class="btn btn-default btn-xs"
             data-toggle="dropdown"
             role="button"
             title="Options"
             style="float:right; margin-left: 3px;">
            <i class="fa fa-cog fa-lg"></i>
          </a>
          <ul class="dropdown-menu text-left pull-right">
            <li class="edit_song_button">
              <a href="#"><i class="fa fa-edit"></i> Edit</a>
            </li>
            <li class="download_song_button">
              <a href="#"><i class="fa fa-download"></i> Download</a>
            </li>
            <li class="queue_song_button">
              <a href="#"><i class="fa fa-level-down fa-rotate-90"></i> Queue</a>
            </li>
          </ul>
        </div>
      </td>
    </script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static 'vendor/jquery/2.1.1/jquery-2.1.1.min.js' %}"></script>
    <script src="{% static 'vendor/jstorage/0.4.12/jstorage.min.js' %}"></script>
    <script src="{% static 'vendor/jquery-backstretch/2.0.4/jquery.backstretch.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/3.3.0/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'vendor/enscroll/0.6.1/enscroll-0.6.1.min.js' %}"></script>
    <script src="{% static 'vendor/underscore/1.7.0/underscore-min.js' %}"></script>
    <script src="{% static 'vendor/backbone/1.1.2/backbone-min.js' %}"></script>
    <script src="{% static 'vendor/soundmanager2/v297a-20140901/script/soundmanager2-nodebug-jsmin.js' %}"></script>
    <script src="{% static 'nickelodeon/app.js' %}"></script>
    <script>
// JQUERY DJANGO CRSF
$(document).ajaxSend(function(event, xhr, settings) {
  function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
        var cookie = jQuery.trim(cookies[i]);
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) == (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  function sameOrigin(url) {
    // url could be relative or scheme relative or absolute
    var host = document.location.host, // host + port
        protocol = document.location.protocol,
        sr_origin = '//' + host,
        origin = protocol + sr_origin;
    // Allow absolute or scheme relative URLs to same origin
    return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
           (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
           // or any other URL that isn't scheme relative or absolute i.e relative.
           !(/^(\/\/|http:|https:).*/.test(url));
  }
  function safeMethod(method) {
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
  }
});
    </script>
    <script>
      (function($){
        $(window).load(function(){
          // Console Decoration
          console.log('\n                          ___        ____\n                         /   \\      /   /\n      ________ _______  /    /___  /   /                     ___\n     /        /       \\/         \\/   /       ______  ____  /  /_\n    /     ___/__      /    _     /   /       /  __  \\/ _  \\/  __/\n   /    /   ___/     /    / /   /    \\__ __ /  / /  / ____/  /\n   \\___/   /     ___/\\___/  \\__/\\______//_//__/ /__/\\_____\\___\\\n          /    /\n          \\___/                            https://www.rphl.net/\n\n');

          // apply enscroll
          $('#tab_selector a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $(window).trigger('resize');
          });
<<<<<<< HEAD
          $('.scrollable').each(
            function(ii){
              $(this).enscroll({
                verticalTrackClass: 'enscroll_track',
                verticalHandleClass: 'enscroll_handle'
              });
=======
        }
      };

      // Button Triggers
      $('#play_pause_button').on('click', function(e){
        e.preventDefault();
        if(playing_status==PAUSED){
          $('#play_pause_button > i').removeClass('fa-play')
                                     .addClass('fa-pause');
        } else {
          if(e.ctrlKey){
            stopping_after_current = true;
            return;
          }
          $('#play_pause_button > i').removeClass('fa-pause')
                                     .addClass('fa-play');
        }
        toggle_play();
      });


      $('#next_button').on('click', play_next_song);
      $('#prev_button').on('click', play_prev_song);

      var start_search = function(){
        var result = $('#search_input').val();
        if(result){
          search(result);
        }
      };
      $('#youtube_import_btn').on('click', function(e){
        e.preventDefault();
        var yt_vid_re = /^[a-zA-Z0-9_-]{11}$/,
            yt_full_url_re = /^(https?:\/\/)?(www\.|m\.)?youtube\.com\/watch\?(.*&)?v=([a-zA-Z0-9_-]{11})(&.*)?$/,
            yt_short_url_re = /^(https?:\/\/)?youtu\.be\/([a-zA-Z0-9_-]{11})(\?.*)?$/,
            yt_vid_id = null;
        $('#downloading_yt_i').hide();
        $('#id_youtube_url').val('')
        $('#youtubeModal').on('shown.bs.modal', function (e) {
          $('#id_youtube_url').focus();
        });
        $("#youtubeModal").modal();
        $("#download_yt_btn")
        .off("click") // deactivate previous action
        .on('click', function(){
          yt_link = $('#id_youtube_url').val();
          if(yt_vid_re.test(yt_link)){
            yt_vid_id = yt_link;
          } else if(yt_full_url_re.test(yt_link)){
            yt_vid_id = yt_link.match(yt_full_url_re)[4];
          }else if(yt_short_url_re.test(yt_link)){
            yt_vid_id = yt_link.match(yt_short_url_re)[2];
          }else{
            alert("Could not recognize YouTube URL")
            return;
          }
          if(yt_vid_id){
            $('#downloading_yt_i').show();
            $.ajax({
              url: '/api/v1/youtube_dl/',
              type: 'POST',
              dataType: 'JSON',
              data: {video_id: yt_vid_id}
            }).success(
              function(response){
                $('#youtubeModal').modal('hide');
              }
            );
          }
        });
      })
      var edit_song = function(song){
        $('#id_song_artist').val(song.artist);
        $('#id_song_title').val(song.title);
        $('#id_song_filename').val(song.filename);
        $('#saving_change_i').hide();
        $("#editSongModal").modal();
        $("#save_song_change_btn")
        .off("click") // deactivate previous action
        .on('click',
          (function(current_data){
            return function(){
              var artist = $('#id_song_artist').val(),
                  title = $('#id_song_title').val(),
                  filename = $('#id_song_filename').val(),
                  uuid = current_data.uuid,
                  update_data = {},
                  data_changed = false;

              if(artist != current_data.artist){
                update_data['artist'] = artist;
                data_changed = true;
              }
              if(title != current_data.title){
                update_data['title'] = title;
                data_changed = true;
              }
              if(filename != current_data.filename){
                update_data['filename'] = filename;
                data_changed = true;
              }
              if(data_changed){
                $('#saving_change_i').show()
                $.ajax({
                  url: '/api/v1/song/'+uuid,
                  type: 'PUT',
                  dataType: 'JSON',
                  data: update_data
                }).success(
                  function(response){
                    $('#editSongModal').modal('hide');
                  }
                );
              }else{
                $('#editSongModal').modal('hide');
              }
>>>>>>> 5fe5bfb9995622b926e3d2921e53b9ae1c7669a7
            }
          );

          // Vertical height adjustement
          var on_resize = function(){
            var height = $(window).height() - ($('#main_navbar').height() + $('#main_footer').height());
            var width = $(window).width();
            $('#main_container').css('height', height+'px');//, "width":"100%"});
            $('#main_div').css('height', height+'px');
            var boxheight = $(window).height() - ($('.tab-pane.active').offset().top  + $('#main_footer').height());
            $('.tab-pane.active').css('height', boxheight+'px')
            $('.tab-pane.active').css('width', '100%')
          };
          $(window).on('resize', on_resize).trigger('resize');

          // Background
          $.backstretch("{% static 'nickelodeon/wallpaper.jpg' %}");

          // App
          var app = JukeBox("{% static 'vendor/soundmanager2/v297a-20140901/swf/' %}");
          $(window).bind('beforeunload', function(){return "Are you sure?";});
        });
      })(jQuery);
    </script>
  </body>
</html>
